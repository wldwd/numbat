<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shire of West Arthur Places of Interest</title>
    <link
      href="https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.css"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
      #legend {
        position: absolute;
        bottom: 30px;
        left: 10px;
        background: white;
        padding: 12px;
        border-radius: 4px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
        font-family: sans-serif;
        font-size: 13px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
      }

      .legend-item:last-child {
        margin-bottom: 0;
      }

      .legend-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
        border: 2px solid #fff;
        box-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
        margin-right: 8px;
      }
      #attribution {
        position: absolute;
        top: 10px;
        left: 10px;
        background: none;
        padding: 6px 10px;
        font-family: sans-serif;
        font-size: 11px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <div id="attribution">
      Data: Shire of West Arthur, Data WA, Trails WA, Rail Trails Australia<br />
      Map: Numbat Geospatial
    </div>
    <div id="legend">
      <div class="legend-item">
        <span class="legend-dot" style="background: #b5651d"></span>Heritage
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background: #ba6de0"></span>Trails
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background: #e63946"></span>Art
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background: #f4a261"></span>Play
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background: #08ddcb"></span>Nature
      </div>
      <div class="legend-item">
        <span class="legend-dot" style="background: #7c3aed"></span>Astrotourism
      </div>
      <div class="legend-item">
        <span
          class="legend-dot"
          style="background: #1d4ed8; border-radius: 0; height: 4px"
        ></span
        >Collie-Darkan Rail Trail
      </div>
      <div class="legend-item">
        <span
          class="legend-dot"
          style="background: #d946ef; border-radius: 0; height: 4px"
        ></span
        >Darkan Heritage Trail
      </div>
      <div
        style="
          border-top: 1px solid #ccc;
          margin-top: 10px;
          padding-top: 10px;
          font-size: 11px;
          color: #666;
        "
      ></div>
    </div>
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.9.4/mapbox-gl.js"></script>
    <script>
      mapboxgl.accessToken =
        "pk.eyJ1IjoibnVtYmF0cHJvamVjdHMiLCJhIjoiY21rMjRwcmVwMGJ4ejNkczd3bW1jZHc1ZyJ9.a9PuI5n8AyG7-BHZvsyeQg";

      const map = new mapboxgl.Map({
        container: "map",
        style: "mapbox://styles/mapbox/outdoors-v12",
        center: [116.73117478944953, -33.47144934260539], // centre of Shire of West Arthur
        zoom: 9,
      });
      // Add a scale control to the map
      map.addControl(new mapboxgl.ScaleControl(), "bottom-right");
      // Add zoom and rotation controls to the map.
      map.addControl(new mapboxgl.NavigationControl(), "top-right");
      map.on("load", () => {
        // LGA boundary
        map.addSource("boundary", {
          type: "geojson",
          data: "west_arthur.geojson",
        });

        map.addLayer({
          id: "boundary-line",
          type: "line",
          source: "boundary",
          paint: {
            "line-color": "#333",
            "line-width": 2,
          },
        });

        // Trail 1: Collie-Darkan
        map.addSource("collie-darkan", {
          type: "geojson",
          data: "COLLIE_DARKAN.geojson",
        });

        map.addLayer({
          id: "collie-darkan-line",
          type: "line",
          source: "collie-darkan",
          paint: {
            "line-color": "#1d4ed8",
            "line-width": 3,
          },
        });

        // Trail 2: Darkan Heritage Trail
        map.addSource("heritage-trail", {
          type: "geojson",
          data: "Darkan_Heritage_Trail.geojson",
        });

        map.addLayer({
          id: "heritage-trail-line",
          type: "line",
          source: "heritage-trail",
          paint: {
            "line-color": "#d946ef",
            "line-width": 3,
          },
        });

        // POIs
        map.addSource("pois", {
          type: "geojson",
          data: "WEST_ARTHUR_POIS.geojson",
        });

        map.addLayer({
          id: "pois-points",
          type: "circle",
          source: "pois",
          paint: {
            "circle-radius": 8,
            "circle-color": [
              "match",
              ["get", "category"],
              "Heritage",
              "#b5651d",
              "Trails",
              "#ba6de0",
              "Art",
              "#e63946",
              "Play",
              "#f4a261",
              "Nature",
              "#08ddcb",
              "Astrotourism",
              "#7c3aed",
              "#888888",
            ],
            "circle-stroke-color": "#fff",
            "circle-stroke-width": 2,
          },
        });
        // POI popups
        map.on("click", "pois-points", (e) => {
          const props = e.features[0].properties;
          const coords = e.features[0].geometry.coordinates;

          const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${coords[1]},${coords[0]}`;

          let html = `<strong>${props.name}</strong>`;

          if (props.description) {
            html += `<p style="margin:8px 0;">${props.description}</p>`;
          }

          if (props.photo_url) {
            html += `<br><img src="${props.photo_url}" style="width:100%;max-width:200px;margin-top:8px;">`;
          }

          if (props.external_link) {
            html += `<br><a href="${props.external_link}" target="_blank">More info</a>`;
          }

          html += `<br><a href="${directionsUrl}" target="_blank">Get directions</a>`;

          new mapboxgl.Popup().setLngLat(coords).setHTML(html).addTo(map);
        });

        // Change cursor on hover
        map.on("mouseenter", "pois-points", () => {
          map.getCanvas().style.cursor = "pointer";
        });

        map.on("mouseleave", "pois-points", () => {
          map.getCanvas().style.cursor = "";
        });
        // Collie-Darkan Rail Trail popup
        map.on("click", "collie-darkan-line", (e) => {
          const html = `
      <strong>Collie-Darkan Rail Trail</strong>
      <img src="https://www.westarthur.wa.gov.au/Profiles/westarthur/Assets/ClientData/Images/rail_trail_2.jpg" style="width:100%;max-width:200px;margin-top:8px;">
      <p style="margin:8px 0;">A scenic rail trail connecting Collie and Darkan.</p>
      <a href="https://trailswa.com.au/trails/trail/collie-darkan-rail-trail" target="_blank">More info & download KML</a>
    `;
          // Darkan Heritage Trail popup
          map.on("click", "heritage-trail-line", (e) => {
            const html = `
      <strong>Darkan Heritage Walk Trail</strong>
      <img src="https://www.westarthur.wa.gov.au/Profiles/westarthur/Assets/ClientData/Images/Nangip_Creek_4_-_Edited.jpg" style="width:100%;max-width:200px;margin-top:8px;">
      <p style="margin:8px 0;">A heritage walk through Darkan.</p>
      <a href="https://trailswa.com.au/trails/trail/darkan-heritage-walk-trail" target="_blank">More info & download KML</a>
    `;

            new mapboxgl.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);
          });

          map.on("mouseenter", "heritage-trail-line", () => {
            map.getCanvas().style.cursor = "pointer";
          });

          map.on("mouseleave", "heritage-trail-line", () => {
            map.getCanvas().style.cursor = "";
          });
          new mapboxgl.Popup().setLngLat(e.lngLat).setHTML(html).addTo(map);
        });

        map.on("mouseenter", "collie-darkan-line", () => {
          map.getCanvas().style.cursor = "pointer";
        });

        map.on("mouseleave", "collie-darkan-line", () => {
          map.getCanvas().style.cursor = "";
        });
      });
    </script>
  </body>
</html>
